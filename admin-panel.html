<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin Panel v4 - Professional Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #3949ab;
            --primary-dark: #283593;
            --secondary: #4fc3f7;
            --success: #00e676;
            --danger: #f44336;
            --warning: #ff9800;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #bbdefb;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(79, 195, 247, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: pulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(15, 52, 96, 0.95) 0%, rgba(26, 26, 46, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 0 1px rgba(79, 195, 247, 0.2);
            border: 2px solid rgba(79, 195, 247, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(79, 195, 247, 0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }
        
        .header h1 { 
            color: var(--secondary);
            margin-bottom: 8px;
            font-size: 32px;
            text-shadow: 0 2px 10px rgba(79, 195, 247, 0.5);
            position: relative;
        }
        
        .header .badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            display: inline-block;
            margin-top: 8px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(245, 87, 108, 0.7); }
        }
        
        .subtitle { 
            color: var(--light);
            font-size: 15px;
            margin-top: 12px;
            position: relative;
        }
        
        .admin-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(79, 195, 247, 0.3);
        }
        
        .admin-email {
            color: var(--secondary);
            font-weight: 600;
            font-size: 14px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .tabs { 
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .tab {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            color: white;
            border: 2px solid rgba(255,255,255,0.1);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(79, 195, 247, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.15);
            border-color: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 195, 247, 0.3);
        }
        
        .tab:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .tab.active { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--secondary);
            box-shadow: 0 8px 30px rgba(57, 73, 171, 0.5);
        }
        
        .panel {
            background: rgba(26, 35, 47, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4), 0 0 0 1px rgba(79, 195, 247, 0.1);
            display: none;
            border: 2px solid rgba(79, 195, 247, 0.2);
        }
        
        .panel.active { 
            display: block;
            animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-row { 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group { 
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            color: var(--light);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 14px;
            letter-spacing: 0.3px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            color: white;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(79, 195, 247, 0.15);
            background: rgba(255,255,255,0.12);
        }
        
        input::placeholder {
            color: rgba(255,255,255,0.4);
        }
        
        button {
            padding: 15px 32px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 400px;
            height: 400px;
        }
        
        button:hover { 
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(79, 195, 247, 0.4);
            border-color: var(--secondary);
        }
        
        button:active { 
            transform: translateY(-1px);
        }
        
        .btn-success { 
            background: linear-gradient(135deg, #00c853 0%, var(--success) 100%);
        }
        
        .btn-success:hover {
            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.4);
        }
        
        .btn-danger { 
            background: linear-gradient(135deg, var(--danger) 0%, #d32f2f 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 10px 30px rgba(244, 67, 54, 0.4);
        }
        
        .btn-warning { 
            background: linear-gradient(135deg, var(--warning) 0%, #ff5722 100%);
        }
        
        .btn-warning:hover {
            box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4);
        }
        
        .btn-small { 
            padding: 10px 18px;
            font-size: 13px;
        }
        
        .alert {
            padding: 18px 24px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-weight: 700;
            display: none;
            border-left: 5px solid;
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .alert.show { 
            display: block;
        }
        
        .alert-success {
            background: rgba(76, 175, 80, 0.25);
            color: #4caf50;
            border-left-color: #4caf50;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        .alert-error {
            background: rgba(244, 67, 54, 0.25);
            color: #f44336;
            border-left-color: #f44336;
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.3);
        }
        
        .user-card, .api-key-card {
            background: rgba(33, 33, 33, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .user-card::before, .api-key-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(79, 195, 247, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .user-card:hover::before, .api-key-card:hover::before {
            left: 100%;
        }
        
        .user-card:hover, .api-key-card:hover {
            border-color: var(--secondary);
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(79, 195, 247, 0.3);
        }
        
        .info { 
            flex: 1;
            min-width: 0;
        }
        
        .name {
            font-weight: 800;
            color: var(--secondary);
            font-size: 17px;
            margin-bottom: 10px;
            text-shadow: 0 2px 8px rgba(79, 195, 247, 0.3);
        }
        
        .api-key-value {
            font-family: 'Courier New', monospace;
            color: var(--success);
            font-size: 13px;
            margin-bottom: 8px;
            background: rgba(0, 230, 118, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            display: inline-block;
        }
        
        .details { 
            color: #b0bec5;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .time-remaining {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            margin-left: 8px;
        }
        
        .time-remaining.expired {
            background: rgba(244, 67, 54, 0.25);
            color: var(--danger);
        }
        
        .time-remaining.warning {
            background: rgba(255, 152, 0, 0.25);
            color: var(--warning);
        }
        
        .time-remaining.good {
            background: rgba(76, 175, 80, 0.25);
            color: #4caf50;
        }
        
        .actions { 
            display: grid;
            gap: 10px;
        }
        
        .actions.user-actions {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            min-width: 300px;
        }
        
        .actions.api-actions {
            grid-template-columns: repeat(3, 1fr);
            min-width: 320px;
        }
        
        .loading { 
            text-align: center;
            padding: 60px;
            color: #b0bec5;
        }
        
        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 28px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--secondary);
            box-shadow: 0 10px 35px rgba(57, 73, 171, 0.4);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1), transparent);
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 45px rgba(57, 73, 171, 0.6);
        }
        
        .stat-number { 
            font-size: 38px;
            font-weight: 900;
            margin-bottom: 8px;
            position: relative;
            text-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .stat-label { 
            font-size: 14px;
            opacity: 0.95;
            position: relative;
            font-weight: 600;
        }
        
        .duration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        
        .duration-btn {
            padding: 14px;
            background: rgba(255,255,255,0.08);
            color: var(--light);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .duration-btn:hover {
            background: rgba(79, 195, 247, 0.2);
            border-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 195, 247, 0.3);
        }
        
        .duration-btn.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--secondary);
            box-shadow: 0 6px 25px rgba(57, 73, 171, 0.5);
        }
        
        .custom-duration-container {
            background: rgba(33, 33, 33, 0.9);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .duration-input-group {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 18px;
        }
        
        .duration-input-group input {
            flex: 1;
            text-align: center;
        }
        
        .duration-display {
            background: rgba(33, 33, 33, 0.9);
            border: 2px solid var(--secondary);
            padding: 18px;
            border-radius: 12px;
            margin: 18px 0;
            text-align: center;
            font-weight: 700;
            color: var(--secondary);
            font-size: 17px;
            box-shadow: 0 6px 25px rgba(79, 195, 247, 0.3);
        }
        
        .modal {
            display: none !important;
            pointer-events: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show { 
            display: flex !important;
            pointer-events: auto;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: rgba(26, 35, 47, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 35px;
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--secondary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            font-size: 22px;
            font-weight: 800;
            color: var(--secondary);
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(79, 195, 247, 0.4);
        }
        
        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 25px;
        }
        
        .advanced-settings {
            background: rgba(33, 33, 33, 0.9);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .setting-item {
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .setting-item:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        
        .setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .setting-item label {
            margin-bottom: 0;
            flex: 1;
            cursor: pointer;
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            padding: 8px;
            font-size: 18px;
        }
        
        .expiry-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(79, 195, 247, 0.2);
            border-radius: 25px;
            font-size: 12px;
            margin-top: 8px;
            font-weight: 700;
        }
        
        .api-docs {
            background: rgba(33, 33, 33, 0.9);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .api-endpoint {
            background: rgba(0, 230, 118, 0.1);
            border-left: 4px solid var(--success);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .code-block {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }
        
        .code-block code {
            color: #00e676;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            white-space: pre;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 6px 12px;
            font-size: 11px;
        }
        
        @media (max-width: 768px) {
            .form-row { 
                grid-template-columns: 1fr;
            }
            
            .tabs { 
                flex-direction: column;
            }
            
            .duration-grid { 
                grid-template-columns: repeat(2, 1fr);
            }
            
            .user-card, .api-key-card {
                flex-direction: column;
                align-items: stretch;
            }
            
            .actions.user-actions,
            .actions.api-actions {
                grid-template-columns: 1fr;
                min-width: 100%;
            }
            
            .duration-input-group {
                flex-direction: column;
            }
            
            .admin-info-bar {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 195, 247, 0.8);
        }
    </style>
</head>



<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: var(--secondary); font-size: 18px;">ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª...</p>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="header">
            <div>
                <h1>ğŸ‘‘ Master Admin Panel v4 - Professional Edition</h1>
                <span class="badge">âœ¨ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø­ØªØ±Ù - Ù…Ø­Ù…ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</span>
                <p class="subtitle">ğŸš€ Ø¥Ø¯Ø§Ø±Ø© Ù…ØªÙ‚Ø¯Ù…Ø© + API Ø§Ø­ØªØ±Ø§ÙÙŠ + Ø¥Ø¬Ø¨Ø§Ø± Ø®Ø±ÙˆØ¬ ÙÙˆØ±ÙŠ + ØªØµØ¯ÙŠØ± Ù…Ø­Ø³Ù‘Ù†</p>
            </div>
            <div class="admin-info-bar">
                <span class="admin-email" id="adminEmail">ğŸ‘¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <button onclick="logoutAdmin()" class="btn-danger btn-small">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('users')">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <button class="tab" onclick="switchTab('apikeys')">ğŸ”‘ Ù…ÙØ§ØªÙŠØ­ API</button>
            <button class="tab" onclick="switchTab('api')">ğŸ“¡ API + Smali</button>
            <button class="tab" onclick="switchTab('stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
            <button class="tab" onclick="switchTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <div id="alertBox" class="alert"></div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div id="usersPanel" class="panel active">
            <h2 style="color: var(--secondary); margin-bottom: 25px; font-size: 24px;">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­ØªØ±ÙØ©</h2>
            
            <form id="addUserForm" style="margin-bottom: 35px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    </div>
                    <div class="form-group">
                        <label>ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="password-container">
                            <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                            <button type="button" class="toggle-password" onclick="togglePassword()">ğŸ‘ï¸</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>â±ï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯Ø©</label>
                    <div class="duration-grid">
                        <button type="button" class="duration-btn" onclick="setDuration(1)">â±ï¸ Ø¯Ù‚ÙŠÙ‚Ø©</button>
                        <button type="button" class="duration-btn" onclick="setDuration(5)">â±ï¸ 5 Ø¯Ù‚Ø§Ø¦Ù‚</button>
                        <button type="button" class="duration-btn" onclick="setDuration(15)">â±ï¸ 15 Ø¯Ù‚ÙŠÙ‚Ø©</button>
                        <button type="button" class="duration-btn" onclick="setDuration(30)">â±ï¸ 30 Ø¯Ù‚ÙŠÙ‚Ø©</button>
                        <button type="button" class="duration-btn" onclick="setDuration(60)">â±ï¸ Ø³Ø§Ø¹Ø©</button>
                        <button type="button" class="duration-btn" onclick="setDuration(180)">â±ï¸ 3 Ø³Ø§Ø¹Ø§Øª</button>
                        <button type="button" class="duration-btn" onclick="setDuration(360)">â±ï¸ 6 Ø³Ø§Ø¹Ø§Øª</button>
                        <button type="button" class="duration-btn" onclick="setDuration(720)">â±ï¸ 12 Ø³Ø§Ø¹Ø©</button>
                        <button type="button" class="duration-btn" onclick="setDuration(1440)">ğŸ“† ÙŠÙˆÙ…</button>
                        <button type="button" class="duration-btn" onclick="setDuration(4320)">ğŸ“† 3 Ø£ÙŠØ§Ù…</button>
                        <button type="button" class="duration-btn" onclick="setDuration(10080)">ğŸ“† Ø£Ø³Ø¨ÙˆØ¹</button>
                        <button type="button" class="duration-btn" onclick="setDuration(43200)">ğŸ“† Ø´Ù‡Ø±</button>
                        <button type="button" class="duration-btn" onclick="setDuration(518400)">ğŸ“† Ø³Ù†Ø©</button>
                    </div>
                </div>

                <div class="custom-duration-container">
                    <h3 style="color: var(--secondary); margin-bottom: 18px; font-size: 18px;">ğŸ“ Ù…Ø¯Ø© Ù…Ø®ØµØµØ©</h3>
                    
                    <div class="duration-input-group">
                        <input type="number" id="customMinutes" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" min="1" value="60">
                        <select id="durationUnit">
                            <option value="minutes">Ø¯Ù‚Ø§Ø¦Ù‚</option>
                            <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                            <option value="days">Ø£ÙŠØ§Ù…</option>
                            <option value="weeks">Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                            <option value="months">Ø´Ù‡ÙˆØ±</option>
                        </select>
                        <button type="button" onclick="setCustomDuration()" class="btn-success">ØªØ¹ÙŠÙŠÙ†</button>
                    </div>
                    
                    <div class="duration-input-group">
                        <input type="number" id="exactDuration" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø§Ù„Ø¶Ø¨Ø·" min="1">
                        <button type="button" onclick="setExactDuration()" class="btn">ØªØ¹ÙŠÙŠÙ† Ø¯Ù‚ÙŠÙ‚</button>
                    </div>
                </div>

                <div class="duration-display" id="dateDisplay">âš ï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                        <select id="maxDevices">
                            <option value="1">1 Ø¬Ù‡Ø§Ø²</option>
                            <option value="2">2 Ø¬Ù‡Ø§Ø²</option>
                            <option value="3">3 Ø£Ø¬Ù‡Ø²Ø©</option>
                            <option value="5">5 Ø£Ø¬Ù‡Ø²Ø©</option>
                            <option value="10">10 Ø£Ø¬Ù‡Ø²Ø©</option>
                            <option value="999">ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <select id="userStatus">
                            <option value="active">âœ… Ù†Ø´Ø·</option>
                            <option value="inactive">â¸ï¸ Ù…Ø¹Ø·Ù„</option>
                            <option value="trial">ğŸ†“ ØªØ¬Ø±ÙŠØ¨ÙŠ</option>
                        </select>
                    </div>
                </div>

                <div class="advanced-settings">
                    <h3 style="color: var(--secondary); margin-bottom: 18px; font-size: 18px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                    
                    <div class="setting-item">
                        <input type="checkbox" id="autoLogout" checked>
                        <label for="autoLogout">ğŸšª Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                    </div>
                    
                    <div class="setting-item">
                        <input type="checkbox" id="singleSession">
                        <label for="singleSession">ğŸ”’ Ø¬Ù„Ø³Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</label>
                    </div>
                    
                    <div class="setting-item">
                        <input type="checkbox" id="notifyBeforeExpiry" checked>
                        <label for="notifyBeforeExpiry">ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                    </div>
                    
                    <div class="form-group" style="margin-top: 18px;">
                        <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="userNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." rows="2"></textarea>
                    </div>
                </div>

                <button type="submit" style="width: 100%; margin-top: 25px; padding: 18px;">
                    â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                </button>
            </form>

            <div style="display: flex; gap: 12px; margin-bottom: 25px; flex-wrap: wrap;">
                <button onclick="loadUsers()" class="btn-success">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                <button onclick="exportUsers('json')" class="btn">ğŸ“¥ JSON</button>
                <button onclick="copyUsersJSON()" class="btn">ğŸ“‹ Ù†Ø³Ø®</button>
                <button onclick="deleteExpiredUsers()" class="btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªÙ‡ÙŠÙŠÙ†</button>
                <button onclick="copyAllUserIds()" class="btn">ğŸ“‹ Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª</button>
            </div>
            
            <div id="usersList" style="margin-top: 25px;"></div>

            <div class="api-docs" style="margin-top: 35px;">
                <h3 style="color: var(--secondary); margin-bottom: 18px;">ğŸ“¡ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø¨Ø± API</h3>
                
                <div class="form-group">
                    <label>ğŸ‘¥ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„ØªÙ…Ø¯ÙŠØ¯ (Ø§ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„)</label>
                    <textarea id="userIdsForExtend" rows="3" placeholder="user_id_1, user_id_2, user_id_3"></textarea>
                </div>

                <div class="duration-input-group">
                    <input type="number" id="apiExtendMinutes" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯" value="1440" min="1">
                    <button onclick="extendMultipleUsers()" class="btn-success">â° ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</button>
                </div>

                <div id="apiExtendResult" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ API -->
        <div id="apikeysPanel" class="panel">
            <h2 style="color: var(--secondary); margin-bottom: 25px; font-size: 24px;">ğŸ”‘ Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ API</h2>
            
            <form id="createApiKeyForm" style="margin-bottom: 35px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±</label>
                        <input type="text" id="adminName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±" required>
                    </div>
                    <div class="form-group">
                        <label>ğŸ”’ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                        <select id="permissionLevel">
                            <option value="full">ğŸ”“ ÙƒØ§Ù…Ù„Ø©</option>
                            <option value="add_only">â• Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø·</option>
                            <option value="view_only">ğŸ‘ï¸ Ø¹Ø±Ø¶ ÙÙ‚Ø·</option>
                            <option value="extend_only">â° ØªÙ…Ø¯ÙŠØ¯ ÙÙ‚Ø·</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>â±ï¸ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙØªØ§Ø­</label>
                    <div class="duration-input-group">
                        <input type="number" id="keyDuration" placeholder="Ø§Ù„Ù…Ø¯Ø©" min="1" value="30">
                        <select id="keyDurationUnit">
                            <option value="days">Ø£ÙŠØ§Ù…</option>
                            <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                            <option value="weeks">Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                            <option value="months">Ø´Ù‡ÙˆØ±</option>
                        </select>
                    </div>
                </div>

                <button type="submit" style="width: 100%;">ğŸ”‘ Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ API</button>
            </form>

            <button onclick="loadApiKeys()" class="btn-success">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            
            <div id="apiKeysList" style="margin-top: 25px;"></div>
        </div>

        <!-- Ù„ÙˆØ­Ø© API + Smali -->
        <div id="apiPanel" class="panel">
            <h2 style="color: var(--secondary); margin-bottom: 25px; font-size: 24px;">ğŸ“¡ API Ø§Ù„ØªØ­ÙƒÙ… + ÙƒÙˆØ¯ Smali</h2>
            
            <div class="api-docs">
                <h3 style="color: var(--secondary); margin-bottom: 18px;">ğŸ”— Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Endpoints)</h3>
                
                <div class="api-endpoint">
                    <strong>GET</strong> /api/users/{userId}
                    <p style="margin-top: 8px; color: #b0bec5;">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…</p>
                </div>
                
                <div class="api-endpoint">
                    <strong>POST</strong> /api/users/{userId}/extend
                    <p style="margin-top: 8px; color: #b0bec5;">ØªÙ…Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù…</p>
                </div>
                
                <div class="api-endpoint">
                    <strong>POST</strong> /api/users/{userId}/force-logout
                    <p style="margin-top: 8px; color: #b0bec5;">Ø¥Ø¬Ø¨Ø§Ø± Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                </div>
            </div>
            
            <div class="advanced-settings" style="margin-top: 30px;">
                <h3 style="color: var(--secondary); margin-bottom: 18px;">â° ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø¨Ø± API</h3>
                
                <div class="form-group">
                    <label>ğŸ‘¥ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø§ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„ Ø£Ùˆ Ø³Ø·ÙˆØ±)</label>
                    <textarea id="apiUserIdsExtend" rows="4" placeholder="user_id_1
user_id_2
user_id_3"></textarea>
                </div>
                
                <div class="duration-input-group">
                    <input type="number" id="apiExtendValue" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" min="1" value="60">
                    <select id="apiExtendUnit">
                        <option value="minutes">Ø¯Ù‚Ø§Ø¦Ù‚</option>
                        <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="days">Ø£ÙŠØ§Ù…</option>
                        <option value="weeks">Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                    </select>
                    <button onclick="extendViaAPI()" class="btn-success">â° ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</button>
                </div>
                
                <div id="apiExtendResults" style="margin-top: 20px; display: none;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px;">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯:</h4>
                    <div id="apiExtendOutput" class="code-block" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
            
            <div class="api-docs" style="margin-top: 25px;">
                <h3 style="color: var(--secondary); margin-bottom: 18px;">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± API</h3>
                
                <div class="form-group">
                    <label>User ID Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                    <input type="text" id="testUserId" placeholder="Ø£Ø¯Ø®Ù„ User ID">
                </div>
                
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button onclick="testGetUser()" class="btn">ğŸ” Get User</button>
                    <button onclick="testExtend()" class="btn-success">â° Test Extend</button>
                    <button onclick="testForceLogout()" class="btn-danger">ğŸšª Test Logout</button>
                </div>
                
                <div id="apiTestResult" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div id="statsPanel" class="panel">
            <h2 style="color: var(--secondary); margin-bottom: 25px; font-size: 24px;">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="expiredUsers">0</div>
                    <div class="stat-label">Ø§Ù„Ù…Ù†ØªÙ‡ÙŠÙŠÙ†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalKeys">0</div>
                    <div class="stat-label">API Keys</div>
                </div>
            </div>

            <div class="api-docs">
                <h3 style="color: var(--secondary); margin-bottom: 18px;">ğŸ“ˆ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø©</h3>
                <div id="durationStats"></div>
            </div>
            
            <button onclick="loadStats()" class="btn-success" style="margin-top: 25px;">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="settingsPanel" class="panel">
            <h2 style="color: var(--secondary); margin-bottom: 25px; font-size: 24px;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
            
            <div class="advanced-settings">
                <div class="setting-item">
                    <input type="checkbox" id="autoCleanup" checked>
                    <label for="autoCleanup">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ</label>
                </div>
                
                <div class="setting-item">
                    <input type="checkbox" id="enableLogging" checked>
                    <label for="enableLogging">ğŸ“ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</label>
                </div>
                
                <div class="setting-item">
                    <input type="checkbox" id="backupEnabled">
                    <label for="backupEnabled">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</label>
                </div>
                
                <div class="form-group" style="margin-top: 25px;">
                    <label>ğŸ”§ Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label>
                    <input type="text" id="dbUrl" value="https://loginapp-8a0ad-default-rtdb.europe-west1.firebasedatabase.app" readonly>
                    <button type="button" onclick="copyDBUrl()" class="btn-small" style="margin-top: 8px;">ğŸ“‹ Ù†Ø³Ø®</button>
                </div>
                
                <div class="form-group">
                    <label>ğŸ”„ ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                    <input type="number" id="sessionCheckInterval" value="5" min="1" max="60">
                </div>
                
                <button onclick="saveSettings()" class="btn-success" style="width: 100%; margin-top: 25px;">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙ…Ø¯ÙŠØ¯ -->
    <div id="extendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">â° ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
            
            <div style="margin-bottom: 25px; background: rgba(33, 33, 33, 0.8); padding: 20px; border-radius: 12px;">
                <strong style="color: var(--secondary);">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="extendUsername"></span><br>
                <strong style="color: var(--secondary);">Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> <span id="extendCurrentExpiry"></span><br>
                <strong style="color: var(--secondary);">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> <span id="extendTimeRemaining"></span>
            </div>

            <div class="form-group">
                <label>â±ï¸ Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø¯ÙŠØ¯</label>
                <div class="duration-grid">
                    <button type="button" class="duration-btn" onclick="setExtendDuration(1)">â±ï¸ Ø¯Ù‚ÙŠÙ‚Ø©</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(5)">â±ï¸ 5 Ø¯Ù‚Ø§Ø¦Ù‚</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(15)">â±ï¸ 15 Ø¯Ù‚ÙŠÙ‚Ø©</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(30)">â±ï¸ 30 Ø¯Ù‚ÙŠÙ‚Ø©</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(60)">â±ï¸ Ø³Ø§Ø¹Ø©</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(180)">â±ï¸ 3 Ø³Ø§Ø¹Ø§Øª</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(720)">â±ï¸ 12 Ø³Ø§Ø¹Ø©</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(1440)">ğŸ“† ÙŠÙˆÙ…</button>
                    <button type="button" class="duration-btn" onclick="setExtendDuration(10080)">ğŸ“† Ø£Ø³Ø¨ÙˆØ¹</button>
                </div>
            </div>

            <div class="custom-duration-container">
                <h4 style="color: var(--secondary); margin-bottom: 12px;">ğŸ“ ØªÙ…Ø¯ÙŠØ¯ Ù…Ø®ØµØµ</h4>
                <div class="duration-input-group">
                    <input type="number" id="extendCustomMinutes" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" min="1" value="60">
                    <select id="extendDurationUnit">
                        <option value="minutes">Ø¯Ù‚Ø§Ø¦Ù‚</option>
                        <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="days">Ø£ÙŠØ§Ù…</option>
                    </select>
                    <button type="button" onclick="setExtendCustom()" class="btn-small">ØªØ¹ÙŠÙŠÙ†</button>
                </div>
            </div>

            <div class="duration-display" id="extendDateDisplay">
                Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø¯ÙŠØ¯
            </div>

            <div class="modal-buttons">
                <button onclick="closeExtendModal()" class="btn-danger">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="confirmExtend()" class="btn-success">âœ… ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù‚ÙˆØ© -->
    <div id="forceActionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âš¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù‚ÙˆØ©</div>
            
            <div style="margin-bottom: 25px; background: rgba(33, 33, 33, 0.8); padding: 20px; border-radius: 12px;">
                <strong style="color: var(--secondary);">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="forceUsername"></span>
            </div>

            <div class="form-group">
                <button onclick="forceLogoutUser()" class="btn-warning" style="width: 100%; margin-bottom: 15px;">
                    ğŸ”¥ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ÙÙˆØ±ÙŠ
                </button>
                <small style="color: var(--warning);">Ø³ÙŠØªÙ… Ø¥Ø®Ø±Ø§Ø¬Ù‡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙÙˆØ±Ø§Ù‹</small>
            </div>

            <div class="form-group">
                <button onclick="resetUserSessions()" class="btn" style="width: 100%; margin-bottom: 15px;">
                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                </button>
            </div>

            <div class="modal-buttons">
                <button onclick="closeForceModal()" class="btn">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>


    <script type="module">
        // ========================================
        // Firebase Configuration & Authentication
        // ========================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCbMdjj7escUMDKvRlD7iaNBTW6ZjhnTDs",
            authDomain: "loginapp-8a0ad.firebaseapp.com",
            databaseURL: "https://loginapp-8a0ad-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "loginapp-8a0ad",
            storageBucket: "loginapp-8a0ad.firebasestorage.app",
            messagingSenderId: "172160411416",
            appId: "1:172160411416:web:74a57f545b87254323e06d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const DB_URL = 'https://loginapp-8a0ad-default-rtdb.europe-west1.firebasedatabase.app';

        // ========================================
        // Global Variables
        // ========================================
        let selectedExpiryDate = null;
        let selectedDurationMinutes = 0;
        let extendUserId = null;
        let extendCurrentTimestamp = null;
        let extendDuration = 0;
        let forceUserId = null;

        // ========================================
        // Authentication & Protection
        // ========================================
        onAuthStateChanged(auth, async (user) => {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const mainContent = document.getElementById('mainContent');

            if (!user) {
                // ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
                alert('â›” ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!');
                window.location.href = 'index.html';
                return;
            }

            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù‡ Ù…Ø³Ø¤ÙˆÙ„
                const adminRef = ref(database, `admins/${user.uid}`);
                const snapshot = await get(adminRef);
                
                if (!snapshot.exists()) {
                    alert('â›” Ø£Ù†Øª Ù„Ø³Øª Ù…Ø³Ø¤ÙˆÙ„Ø§Ù‹!');
                    await signOut(auth);
                    window.location.href = 'index.html';
                    return;
                }

                // Ù…Ø³Ø¤ÙˆÙ„ Ù…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡
                console.log('âœ… Admin authenticated:', user.email);
                document.getElementById('adminEmail').textContent = `ğŸ‘¤ ${user.email}`;
                
                // Ø¥Ø®ÙØ§Ø¡ Loading ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                loadingOverlay.classList.add('hidden');
                mainContent.style.display = 'block';
                
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø©
                initializeAdminPanel();

            } catch (error) {
                console.error('Error checking admin:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
                window.location.href = 'index.html';
            }
        });

        // ========================================
        // Logout Function
        // ========================================
        window.logoutAdmin = async function() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) return;
            
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message);
            }
        }

        // ========================================
        // Initialize Admin Panel
        // ========================================
        function initializeAdminPanel() {
            loadUsers();
            loadSettings();
            loadStats();
            setDuration(60);
            
            console.log('%cğŸš€ Master Admin Panel v4 - Professional Edition', 
                'color: #4fc3f7; font-size: 16px; font-weight: bold;');
            console.log('%câœ… System initialized successfully', 
                'color: #00e676; font-size: 14px;');
            
            checkExpiredSessions();
        }

        // ========================================
        // Core Functions
        // ========================================
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            
            const tabs = ['users', 'apikeys', 'api', 'stats', 'settings'];
            const tabIndex = tabs.indexOf(tab);
            
            if (tabIndex !== -1) {
                document.querySelectorAll('.tab')[tabIndex].classList.add('active');
                document.getElementById(`${tab}Panel`).classList.add('active');
                
                if (tab === 'apikeys') loadApiKeys();
                if (tab === 'stats') loadStats();
            }
        }
        window.switchTab = switchTab;
        
        function showAlert(message, type) {
            const alert = document.getElementById('alertBox');
            alert.textContent = message;
            alert.className = `alert alert-${type} show`;
            setTimeout(() => alert.classList.remove('show'), 5000);
        }
        
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        }
        window.togglePassword = togglePassword;
        
        function setDuration(minutes) {
            document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('selected'));
            if (event) event.target.classList.add('selected');
            
            selectedDurationMinutes = minutes;
            const now = new Date();
            selectedExpiryDate = new Date(now.getTime() + (minutes * 60 * 1000));
            updateDateDisplay(selectedExpiryDate);
            showAlert(`ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¯Ø©: ${formatDuration(minutes)}`, 'success');
        }
        window.setDuration = setDuration;
        
        function setCustomDuration() {
            const value = parseInt(document.getElementById('customMinutes').value);
            const unit = document.getElementById('durationUnit').value;
            
            if (!value || value < 1) {
                showAlert('âŒ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            let minutes = value;
            switch(unit) {
                case 'hours': minutes = value * 60; break;
                case 'days': minutes = value * 24 * 60; break;
                case 'weeks': minutes = value * 7 * 24 * 60; break;
                case 'months': minutes = value * 30 * 24 * 60; break;
            }
            
            setDuration(minutes);
        }
        window.setCustomDuration = setCustomDuration;
        
        function setExactDuration() {
            const minutes = parseInt(document.getElementById('exactDuration').value);
            if (!minutes || minutes < 1) {
                showAlert('âŒ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            setDuration(minutes);
        }
        window.setExactDuration = setExactDuration;
        
        function formatDuration(minutes) {
            if (minutes < 60) return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (minutes < 1440) return `${(minutes/60).toFixed(1)} Ø³Ø§Ø¹Ø©`;
            if (minutes < 10080) return `${(minutes/1440).toFixed(1)} ÙŠÙˆÙ…`;
            if (minutes < 43200) return `${(minutes/10080).toFixed(1)} Ø£Ø³Ø¨ÙˆØ¹`;
            return `${(minutes/43200).toFixed(1)} Ø´Ù‡Ø±`;
        }
        
        function updateDateDisplay(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            const display = document.getElementById('dateDisplay');
            const duration = getTimeRemaining(Date.now(), date.getTime());
            display.textContent = `âœ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${day}/${month}/${year} ${hours}:${minutes} (${duration})`;
        }
        
        function formatDateForFirebase(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }
        
        function getTimeRemaining(now, expiryTimestamp) {
            const diff = expiryTimestamp - now;
            
            if (diff <= 0) return 'Ù…Ù†ØªÙ‡ÙŠ';
            
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days > 0) return `${days} ÙŠÙˆÙ…`;
            if (hours > 0) return `${hours} Ø³Ø§Ø¹Ø©`;
            return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
        }
        
        function getTimeRemainingClass(now, expiryTimestamp) {
            const diff = expiryTimestamp - now;
            
            if (diff <= 0) return 'expired';
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            if (hours < 1) return 'warning';
            if (hours < 24) return 'good';
            return 'good';
        }

        // ========================================
        // Add User Form
        // ========================================
        document.getElementById('addUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedExpiryDate) {
                showAlert('âŒ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹!', 'error');
                return;
            }
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const maxDevices = document.getElementById('maxDevices').value;
            const userStatus = document.getElementById('userStatus').value;
            const userNotes = document.getElementById('userNotes').value;
            const autoLogout = document.getElementById('autoLogout').checked;
            const singleSession = document.getElementById('singleSession').checked;
            
            const passwordHash = CryptoJS.SHA256(password).toString();
            const timestamp = Date.now();
            const userId = `user_${username}_${timestamp}`;
            const sessionToken = CryptoJS.SHA256(userId + timestamp).toString();
            
            const userData = {
                username: username,
                password_hash: passwordHash,
                device_id: "",
                expiry_date: formatDateForFirebase(selectedExpiryDate),
                expiry_timestamp: selectedExpiryDate.getTime(),
                is_active: userStatus === 'active',
                status: userStatus,
                max_devices: parseInt(maxDevices),
                created_at: timestamp,
                last_updated: timestamp,
                created_by: auth.currentUser.email,
                notes: userNotes,
                settings: {
                    auto_logout: autoLogout,
                    single_session: singleSession,
                    session_expiry: selectedExpiryDate.getTime()
                },
                session_token: sessionToken,
                force_logout: false,
                logout_timestamp: null,
                login_history: []
            };
            
            try {
                const response = await fetch(`${DB_URL}/users/${userId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    const duration = getTimeRemaining(Date.now(), selectedExpiryDate.getTime());
                    showAlert(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${username}" - Ø§Ù„Ù…Ø¯Ø©: ${duration}`, 'success');
                    document.getElementById('addUserForm').reset();
                    selectedExpiryDate = null;
                    selectedDurationMinutes = 0;
                    document.getElementById('dateDisplay').textContent = 'âš ï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹';
                    document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('selected'));
                    loadUsers();
                } else {
                    showAlert('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'error');
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        });

        // ========================================
        // Load Users
        // ========================================
        async function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>';
            
            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                
                if (!users) {
                    usersList.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>';
                    return;
                }
                
                const now = Date.now();
                let html = '<h3 style="color: var(--secondary); margin-bottom: 18px; font-size: 20px;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>';
                
                for (const [userId, userData] of Object.entries(users)) {
                    const statusIcon = userData.is_active ? 'âœ…' : 'â¸ï¸';
                    const statusColor = userData.is_active ? '#4caf50' : '#ff9800';
                    
                    const timeRemaining = getTimeRemaining(now, userData.expiry_timestamp);
                    const timeClass = getTimeRemainingClass(now, userData.expiry_timestamp);
                    
                    const durationMinutes = Math.max(0, Math.floor((userData.expiry_timestamp - now) / (1000 * 60)));
                    
                    const deviceIdHtml = userData.device_id ? 
                        `<div class="expiry-badge" style="margin-top: 5px;">
                            ğŸ“± Device ID: 
                            <span onclick="copyToClipboard('${userData.device_id}', 'âœ… ØªÙ… Ù†Ø³Ø® Device ID')" 
                                  style="cursor: pointer; background: rgba(79, 195, 247, 0.2); padding: 2px 8px; border-radius: 10px; margin-left: 5px;">
                                ${userData.device_id.substring(0, 12)}...
                            </span>
                        </div>` : 
                        '<div class="expiry-badge" style="margin-top: 5px; background: rgba(255,255,255,0.1);">ğŸ“± Ù„Ø§ ÙŠÙˆØ¬Ø¯ Device ID</div>';
                    
                    html += `
                        <div class="user-card">
                            <div class="info">
                                <div class="name">${statusIcon} ${userData.username}</div>
                                <div class="details">
                                    <span style="color: ${statusColor}; font-weight: 600;">${userData.status || 'Ù†Ø´Ø·'}</span> | 
                                    ğŸ“… ${userData.expiry_date} 
                                    <span class="time-remaining ${timeClass}">${timeRemaining}</span>
                                </div>
                                <div class="expiry-badge">
                                    â±ï¸ ${durationMinutes} Ø¯Ù‚ÙŠÙ‚Ø©
                                </div>
                                ${deviceIdHtml}
                                ${userData.notes ? `<div style="margin-top: 8px; color: #90caf9; font-size: 12px;">ğŸ“ ${userData.notes}</div>` : ''}
                            </div>
                            <div class="actions user-actions">
                                <button class="btn-small btn-warning" onclick='openExtendModal("${userId}", "${userData.username}", "${userData.expiry_date}", ${userData.expiry_timestamp})'>
                                    â° ØªÙ…Ø¯ÙŠØ¯
                                </button>
                                <button class="btn-small" onclick="openForceActions('${userId}', '${userData.username}')">
                                    âš¡ Ù‚ÙˆØ©
                                </button>
                                <button class="btn-small" onclick="toggleUserStatus('${userId}', ${userData.is_active})">
                                    ${userData.is_active ? 'â¸ï¸ ØªØ¹Ø·ÙŠÙ„' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                                </button>
                                <button class="btn-small btn-danger" onclick="deleteUser('${userId}', '${userData.username}')">
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                usersList.innerHTML = html;
            } catch (error) {
                usersList.innerHTML = '<p style="text-align: center; color: #f44336; padding: 40px;">âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>';
            }
        }
        window.loadUsers = loadUsers;

        // ========================================
        // Extend Modal Functions
        // ========================================
        function openExtendModal(userId, username, currentExpiry, currentTimestamp) {
            extendUserId = userId;
            extendCurrentTimestamp = currentTimestamp;
            extendDuration = 0;
            
            document.getElementById('extendUsername').textContent = username;
            document.getElementById('extendCurrentExpiry').textContent = currentExpiry;
            const timeRemaining = getTimeRemaining(Date.now(), currentTimestamp);
            document.getElementById('extendTimeRemaining').textContent = timeRemaining;
            document.getElementById('extendDateDisplay').textContent = 'Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø¯ÙŠØ¯';
            document.querySelectorAll('#extendModal .duration-btn').forEach(btn => btn.classList.remove('selected'));
            
            document.getElementById('extendModal').classList.add('show');
        }
        window.openExtendModal = openExtendModal;
        
        function closeExtendModal() {
            document.getElementById('extendModal').classList.remove('show');
        }
        window.closeExtendModal = closeExtendModal;
        
        function setExtendDuration(minutes) {
            document.querySelectorAll('#extendModal .duration-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            extendDuration = minutes * 60 * 1000;
            updateExtendDisplay();
        }
        window.setExtendDuration = setExtendDuration;
        
        function setExtendCustom() {
            const value = parseInt(document.getElementById('extendCustomMinutes').value);
            const unit = document.getElementById('extendDurationUnit').value;
            
            if (!value || value < 1) {
                showAlert('âŒ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            let minutes = value;
            switch(unit) {
                case 'hours': minutes = value * 60; break;
                case 'days': minutes = value * 24 * 60; break;
            }
            
            extendDuration = minutes * 60 * 1000;
            updateExtendDisplay();
        }
        window.setExtendCustom = setExtendCustom;
        
        function updateExtendDisplay() {
            const newTimestamp = extendCurrentTimestamp + extendDuration;
            const newDate = new Date(newTimestamp);
            const day = String(newDate.getDate()).padStart(2, '0');
            const month = String(newDate.getMonth() + 1).padStart(2, '0');
            const year = newDate.getFullYear();
            
            const duration = getTimeRemaining(Date.now(), newTimestamp);
            
            document.getElementById('extendDateDisplay').textContent = 
                `âœ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${day}/${month}/${year} (${duration})`;
        }
        
        async function confirmExtend() {
            if (extendDuration === 0) {
                showAlert('âŒ Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø¯ÙŠØ¯!', 'error');
                return;
            }
            
            const newTimestamp = extendCurrentTimestamp + extendDuration;
            const newDate = new Date(newTimestamp);
            
            try {
                const updates = {
                    expiry_date: formatDateForFirebase(newDate),
                    expiry_timestamp: newTimestamp,
                    last_updated: Date.now()
                };
                
                const response = await fetch(`${DB_URL}/users/${extendUserId}.json`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    const duration = getTimeRemaining(Date.now(), newTimestamp);
                    showAlert(`âœ… ØªÙ… Ø§Ù„ØªÙ…Ø¯ÙŠØ¯! Ø§Ù„Ù…Ø¯Ø©: ${duration}`, 'success');
                    closeExtendModal();
                    loadUsers();
                } else {
                    showAlert('âŒ ÙØ´Ù„ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯', 'error');
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.confirmExtend = confirmExtend;

        // ========================================
        // Force Actions Modal
        // ========================================
        function openForceActions(userId, username) {
            forceUserId = userId;
            document.getElementById('forceUsername').textContent = username;
            document.getElementById('forceActionsModal').classList.add('show');
        }
        window.openForceActions = openForceActions;
        
        function closeForceModal() {
            document.getElementById('forceActionsModal').classList.remove('show');
        }
        window.closeForceModal = closeForceModal;
        
        async function forceLogoutUser() {
            if (!confirm(`Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ÙÙˆØ±ÙŠØŸ`)) return;
            
            try {
                const updates = {
                    force_logout: true,
                    logout_timestamp: Date.now(),
                    session_token: null,
                    last_updated: Date.now()
                };
                
                const response = await fetch(`${DB_URL}/users/${forceUserId}.json`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    showAlert('âœ… ØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬!', 'success');
                    closeForceModal();
                    loadUsers();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.forceLogoutUser = forceLogoutUser;
        
        async function resetUserSessions() {
            if (!confirm(`Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§ØªØŸ`)) return;
            
            try {
                const updates = {
                    device_id: "",
                    session_token: null,
                    force_logout: false,
                    last_updated: Date.now()
                };
                
                const response = await fetch(`${DB_URL}/users/${forceUserId}.json`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    showAlert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†!', 'success');
                    closeForceModal();
                    loadUsers();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.resetUserSessions = resetUserSessions;

        // ========================================
        // User Management Functions
        // ========================================
        async function toggleUserStatus(userId, currentStatus) {
            try {
                const response = await fetch(`${DB_URL}/users/${userId}/is_active.json`, {
                    method: 'PUT',
                    body: JSON.stringify(!currentStatus)
                });
                if (response.ok) {
                    showAlert(`âœ… ØªÙ… ${!currentStatus ? 'Ø§Ù„ØªÙØ¹ÙŠÙ„' : 'Ø§Ù„ØªØ¹Ø·ÙŠÙ„'}!`, 'success');
                    loadUsers();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.toggleUserStatus = toggleUserStatus;
        
        async function deleteUser(userId, username) {
            if (!confirm(`Ø­Ø°Ù "${username}"ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!`)) return;
            try {
                const response = await fetch(`${DB_URL}/users/${userId}.json`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert(`âœ… ØªÙ… Ø­Ø°Ù "${username}"!`, 'success');
                    loadUsers();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.deleteUser = deleteUser;
        
        async function deleteExpiredUsers() {
            if (!confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠÙŠÙ†ØŸ')) return;
            
            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                const now = Date.now();
                let deleted = 0;
                
                if (users) {
                    for (const [userId, userData] of Object.entries(users)) {
                        if (userData.expiry_timestamp && userData.expiry_timestamp <= now) {
                            await fetch(`${DB_URL}/users/${userId}.json`, { method: 'DELETE' });
                            deleted++;
                        }
                    }
                    
                    showAlert(`âœ… ØªÙ… Ø­Ø°Ù ${deleted} Ù…Ø³ØªØ®Ø¯Ù…!`, 'success');
                    loadUsers();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.deleteExpiredUsers = deleteExpiredUsers;

        // ========================================
        // Export Functions
        // ========================================
        async function exportUsers(format = 'json') {
            showAlert('Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù Ø§Ù„ØªØµØ¯ÙŠØ±...', 'success');

            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                
                if (!users || Object.keys(users).length === 0) {
                    showAlert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                    return;
                }
                
                const userArray = Object.entries(users).map(([userId, userData]) => ({
                    id: userId,
                    username: userData.username || '',
                    device_id: userData.device_id || '',
                    expiry_date: userData.expiry_date || '',
                    expiry_timestamp: userData.expiry_timestamp || 0,
                    is_active: userData.is_active || false,
                    status: userData.status || '',
                    max_devices: userData.max_devices || 1,
                    created_at: userData.created_at || 0,
                    last_updated: userData.last_updated || 0,
                    notes: userData.notes || ''
                }));
                
                if (format === 'json') {
                    const exportData = JSON.stringify(userArray, null, 2);
                    const filename = `users_export_${new Date().toISOString().split('T')[0]}.json`;
                    
                    if (typeof Android !== 'undefined' && Android.downloadFile) {
                        Android.downloadFile(exportData, filename, "application/json");
                    } else {
                        const blob = new Blob([exportData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename;
                        a.click();
                        URL.revokeObjectURL(url);
                        showAlert('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    }
                }
                
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message, 'error');
            }
        }
        window.exportUsers = exportUsers;
        
        async function copyUsersJSON() {
            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                
                if (!users) {
                    showAlert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                    return;
                }
                
                const exportData = {
                    export_date: new Date().toISOString(),
                    total_users: Object.keys(users).length,
                    users: Object.entries(users).map(([userId, userData]) => ({
                        id: userId,
                        username: userData.username || '',
                        device_id: userData.device_id || '',
                        expiry_date: userData.expiry_date || '',
                        is_active: userData.is_active || false,
                        status: userData.status || '',
                        created_at: new Date(userData.created_at || Date.now()).toLocaleString('ar-SA'),
                        notes: userData.notes || ''
                    }))
                };
                
                const jsonString = JSON.stringify(exportData, null, 2);
                
                if (typeof Android !== 'undefined' && Android.copyToClipboard) {
                    Android.copyToClipboard(jsonString);
                    showAlert('âœ… ØªÙ… Ù†Ø³Ø® JSON Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!', 'success');
                } else {
                    await copyToClipboard(jsonString, 'âœ… ØªÙ… Ù†Ø³Ø® JSON Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
                }
                
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®: ' + error.message, 'error');
            }
        }
        window.copyUsersJSON = copyUsersJSON;
        
        async function copyAllUserIds() {
            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                
                if (!users) {
                    showAlert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                    return;
                }
                
                const userIds = Object.keys(users);
                const userIdsText = userIds.join('\n');
                
                if (typeof Android !== 'undefined' && Android.copyToClipboard) {
                    Android.copyToClipboard(userIdsText);
                    showAlert(`âœ… ØªÙ… Ù†Ø³Ø® ${userIds.length} Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…!`, 'success');
                } else {
                    await copyToClipboard(userIdsText, `âœ… ØªÙ… Ù†Ø³Ø® ${userIds.length} Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…!`);
                }
                
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®: ' + error.message, 'error');
            }
        }
        window.copyAllUserIds = copyAllUserIds;

        // ========================================
        // Bulk Extend Functions
        // ========================================
        async function extendMultipleUsers() {
            const userIdsInput = document.getElementById('userIdsForExtend').value.trim();
            const minutes = parseInt(document.getElementById('apiExtendMinutes').value);
            
            if (!userIdsInput || !minutes) {
                showAlert('âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø©!', 'error');
                return;
            }
            
            const userIds = userIdsInput.split(',').map(id => id.trim()).filter(id => id);
            const resultDiv = document.getElementById('apiExtendResult');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯...</p></div>';
            
            let successCount = 0;
            let failCount = 0;
            let results = [];
            
            for (const userId of userIds) {
                try {
                    const response = await fetch(`${DB_URL}/users/${userId}.json`);
                    const userData = await response.json();
                    
                    if (userData) {
                        const newTimestamp = userData.expiry_timestamp + (minutes * 60 * 1000);
                        const newDate = new Date(newTimestamp);
                        
                        const updates = {
                            expiry_timestamp: newTimestamp,
                            expiry_date: formatDateForFirebase(newDate),
                            last_updated: Date.now(),
                            extended_by: "api_bulk",
                            extension_minutes: minutes
                        };
                        
                        await fetch(`${DB_URL}/users/${userId}.json`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(updates)
                        });
                        
                        successCount++;
                        results.push(`âœ… ${userId}: ØªÙ… Ø§Ù„ØªÙ…Ø¯ÙŠØ¯`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${userId}: ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                    }
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${userId}: Ø®Ø·Ø£ - ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            resultDiv.innerHTML = `
                <div class="api-docs" style="margin: 0;">
                    <h4 style="color: var(--success); margin-bottom: 10px;">âœ… ØªÙ… Ø§Ù„ØªÙ…Ø¯ÙŠØ¯!</h4>
                    <div class="code-block" style="background: rgba(0, 230, 118, 0.1); max-height: 200px; overflow-y: auto;">
                        <code style="color: #fff;">
ØªÙ… ØªÙ…Ø¯ÙŠØ¯ ${successCount} Ù…Ø³ØªØ®Ø¯Ù…
ÙØ´Ù„ ØªÙ…Ø¯ÙŠØ¯ ${failCount} Ù…Ø³ØªØ®Ø¯Ù…
Ø§Ù„Ù…Ø¯Ø©: ${formatDuration(minutes)}
                        
${results.join('\n')}
                        </code>
                    </div>
                </div>
            `;
            
            loadUsers();
        }
        window.extendMultipleUsers = extendMultipleUsers;
        
        async function extendViaAPI() {
            const userIdsInput = document.getElementById('apiUserIdsExtend').value.trim();
            const value = parseInt(document.getElementById('apiExtendValue').value);
            const unit = document.getElementById('apiExtendUnit').value;
            
            if (!userIdsInput || !value || value < 1) {
                showAlert('âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø©!', 'error');
                return;
            }
            
            let minutes = value;
            switch(unit) {
                case 'hours': minutes = value * 60; break;
                case 'days': minutes = value * 24 * 60; break;
                case 'weeks': minutes = value * 7 * 24 * 60; break;
            }
            
            const userIds = userIdsInput.split(/[\n,]/)
                .map(id => id.trim())
                .filter(id => id.length > 0);
            
            if (userIds.length === 0) {
                showAlert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØ§Øª Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            document.getElementById('apiExtendResults').style.display = 'block';
            document.getElementById('apiExtendOutput').innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯...</p></div>';
            
            let results = [];
            let successCount = 0;
            let failCount = 0;
            
            for (const userId of userIds) {
                try {
                    const response = await fetch(`${DB_URL}/users/${userId}.json`);
                    const userData = await response.json();
                    
                    if (!userData) {
                        results.push(`âŒ ${userId}: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                        failCount++;
                        continue;
                    }
                    
                    const currentTimestamp = userData.expiry_timestamp || Date.now();
                    const newTimestamp = currentTimestamp + (minutes * 60 * 1000);
                    const newDate = new Date(newTimestamp);
                    
                    const updates = {
                        expiry_timestamp: newTimestamp,
                        expiry_date: formatDateForFirebase(newDate),
                        last_updated: Date.now(),
                        extended_by: 'api_bulk',
                        extension_minutes: minutes
                    };
                    
                    const updateResponse = await fetch(`${DB_URL}/users/${userId}.json`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updates)
                    });
                    
                    if (updateResponse.ok) {
                        const timeRemaining = getTimeRemaining(Date.now(), newTimestamp);
                        results.push(`âœ… ${userId}: ØªÙ… Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ - Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeRemaining}`);
                        successCount++;
                    } else {
                        results.push(`âŒ ${userId}: ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«`);
                        failCount++;
                    }
                    
                } catch (error) {
                    results.push(`âŒ ${userId}: Ø®Ø·Ø£ - ${error.message}`);
                    failCount++;
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const outputHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ:</strong><br>
                    âœ… ØªÙ… Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­: ${successCount}<br>
                    âŒ ÙØ´Ù„ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯: ${failCount}<br>
                    â° Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©: ${formatDuration(minutes)}
                </div>
                <hr style="margin: 10px 0; border-color: rgba(255,255,255,0.1);">
                <strong>ğŸ“‹ Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong><br>
                <div style="max-height: 150px; overflow-y: auto; margin-top: 5px;">
                    ${results.map(r => `<div style="padding: 2px 0; font-family: monospace; font-size: 12px;">${r}</div>`).join('')}
                </div>
            `;
            
            document.getElementById('apiExtendOutput').innerHTML = outputHTML;
            setTimeout(() => loadUsers(), 1000);
            showAlert(`âœ… ØªÙ… ØªÙ…Ø¯ÙŠØ¯ ${successCount} Ù…Ø³ØªØ®Ø¯Ù…!`, 'success');
        }
        window.extendViaAPI = extendViaAPI;

        // ========================================
        // API Testing Functions
        // ========================================
        async function testGetUser() {
            const userId = document.getElementById('testUserId').value.trim();
            if (!userId) {
                showAlert('âŒ Ø£Ø¯Ø®Ù„ User ID', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p></div>';
            
            try {
                const response = await fetch(`${DB_URL}/users/${userId}.json`);
                const data = await response.json();
                
                if (data) {
                    const now = Date.now();
                    const timeRemaining = getTimeRemaining(now, data.expiry_timestamp);
                    
                    resultDiv.innerHTML = `
                        <div class="api-docs" style="margin: 0;">
                            <h4 style="color: var(--success); margin-bottom: 15px;">âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h4>
                            <div class="code-block" style="background: rgba(0, 230, 118, 0.1);">
                                <code style="color: #fff;">Username: ${data.username}
Status: ${data.is_active ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
Expiry: ${data.expiry_date}
Remaining: ${timeRemaining}
Force Logout: ${data.force_logout ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}
Max Devices: ${data.max_devices}
Device ID: ${data.device_id || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</code>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--warning);">âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--danger);">âŒ Ø®Ø·Ø£: ${error.message}</h4></div>`;
            }
        }
        window.testGetUser = testGetUser;
        
        async function testExtend() {
            const userId = document.getElementById('testUserId').value.trim();
            if (!userId) {
                showAlert('âŒ Ø£Ø¯Ø®Ù„ User ID', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯...</p></div>';
            
            try {
                const getResponse = await fetch(`${DB_URL}/users/${userId}.json`);
                const userData = await getResponse.json();
                
                if (!userData) {
                    resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--warning);">âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4></div>`;
                    return;
                }
                
                const extendMinutes = 60;
                const newTimestamp = userData.expiry_timestamp + (extendMinutes * 60 * 1000);
                const newDate = new Date(newTimestamp);
                
                const updates = {
                    expiry_timestamp: newTimestamp,
                    expiry_date: formatDateForFirebase(newDate),
                    last_updated: Date.now()
                };
                
                const response = await fetch(`${DB_URL}/users/${userId}.json`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    const timeRemaining = getTimeRemaining(Date.now(), newTimestamp);
                    resultDiv.innerHTML = `
                        <div class="api-docs">
                            <h4 style="color: var(--success); margin-bottom: 15px;">âœ… Ù†Ø¬Ø­ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯</h4>
                            <div class="code-block" style="background: rgba(0, 230, 118, 0.1);">
                                <code style="color: #fff;">Extended: +${extendMinutes} minutes
New Expiry: ${formatDateForFirebase(newDate)}
New Remaining: ${timeRemaining}</code>
                            </div>
                        </div>
                    `;
                    loadUsers();
                } else {
                    resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--danger);">âŒ ÙØ´Ù„ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯</h4></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--danger);">âŒ Ø®Ø·Ø£: ${error.message}</h4></div>`;
            }
        }
        window.testExtend = testExtend;
        
        async function testForceLogout() {
            const userId = document.getElementById('testUserId').value.trim();
            if (!userId) {
                showAlert('âŒ Ø£Ø¯Ø®Ù„ User ID', 'error');
                return;
            }
            
            if (!confirm('Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) return;
            
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p></div>';
            
            try {
                const updates = {
                    force_logout: true,
                    logout_timestamp: Date.now(),
                    session_token: null,
                    last_updated: Date.now()
                };
                
                const response = await fetch(`${DB_URL}/users/${userId}.json`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="api-docs">
                            <h4 style="color: var(--success); margin-bottom: 15px;">âœ… Ù†Ø¬Ø­ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬</h4>
                            <div class="code-block" style="background: rgba(0, 230, 118, 0.1);">
                                <code style="color: #fff;">Force Logout: âœ… ØªÙ…
Logout Timestamp: ${new Date(Date.now()).toLocaleString('ar')}
Session Token: ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</code>
                            </div>
                            <p style="margin-top: 15px; color: var(--warning);">
                                âš ï¸ Ø³ÙŠØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªØ§Ù„ÙŠ
                            </p>
                        </div>
                    `;
                    loadUsers();
                } else {
                    resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--danger);">âŒ ÙØ´Ù„ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬</h4></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="api-docs"><h4 style="color: var(--danger);">âŒ Ø®Ø·Ø£: ${error.message}</h4></div>`;
            }
        }
        window.testForceLogout = testForceLogout;

        // ========================================
        // API Keys Management
        // ========================================
        document.getElementById('createApiKeyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const adminName = document.getElementById('adminName').value.trim();
            const permissionLevel = document.getElementById('permissionLevel').value;
            const keyDuration = parseInt(document.getElementById('keyDuration').value);
            const keyDurationUnit = document.getElementById('keyDurationUnit').value;
            
            let durationMinutes = keyDuration;
            switch(keyDurationUnit) {
                case 'hours': durationMinutes = keyDuration * 60; break;
                case 'days': durationMinutes = keyDuration * 24 * 60; break;
                case 'weeks': durationMinutes = keyDuration * 7 * 24 * 60; break;
                case 'months': durationMinutes = keyDuration * 30 * 24 * 60; break;
            }
            
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let apiKey = 'sk_';
            for (let i = 0; i < 48; i++) {
                apiKey += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            const timestamp = Date.now();
            const expiryTimestamp = timestamp + (durationMinutes * 60 * 1000);
            const keyId = `key_${timestamp}`;
            
            const keyData = {
                admin_name: adminName,
                api_key: apiKey,
                permission_level: permissionLevel,
                is_active: true,
                created_at: timestamp,
                expiry_timestamp: expiryTimestamp,
                last_used: null,
                usage_count: 0
            };
            
            try {
                const response = await fetch(`${DB_URL}/api_keys/${keyId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(keyData)
                });
                
                if (response.ok) {
                    showAlert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ API Key!`, 'success');
                    document.getElementById('createApiKeyForm').reset();
                    
                    if (typeof Android !== 'undefined' && Android.copyToClipboard) {
                        Android.copyToClipboard(apiKey);
                        Android.showToast(`âœ… ØªÙ… Ù†Ø³Ø® API Key!\n\nØ§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${formatDuration(durationMinutes)}`);
                    } else {
                        await copyToClipboard(apiKey, `âœ… ØªÙ… Ù†Ø³Ø® API Key!`);
                    }
                    
                    loadApiKeys();
                } else {
                    showAlert('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', 'error');
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        });
        
        async function loadApiKeys() {
            const apiKeysList = document.getElementById('apiKeysList');
            apiKeysList.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>';
            
            try {
                const response = await fetch(`${DB_URL}/api_keys.json`);
                const keys = await response.json();
                
                if (!keys) {
                    apiKeysList.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØ§ØªÙŠØ­</p>';
                    return;
                }
                
                let html = '<h3 style="color: var(--secondary); margin-bottom: 18px; font-size: 20px;">ğŸ”‘ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­</h3>';
                for (const [keyId, keyData] of Object.entries(keys)) {
                    const status = keyData.is_active ? 'âœ… Ù†Ø´Ø·' : 'âŒ Ù…Ø¹Ø·Ù„';
                    const statusColor = keyData.is_active ? '#4caf50' : '#f44336';
                    
                    const permissionText = {
                        'full': 'ğŸ”“ ÙƒØ§Ù…Ù„Ø©',
                        'add_only': 'â• Ø¥Ø¶Ø§ÙØ©',
                        'view_only': 'ğŸ‘ï¸ Ø¹Ø±Ø¶',
                        'extend_only': 'â° ØªÙ…Ø¯ÙŠØ¯'
                    }[keyData.permission_level] || keyData.permission_level;
                    
                    const timeRemaining = getTimeRemaining(Date.now(), keyData.expiry_timestamp);
                    const timeClass = getTimeRemainingClass(Date.now(), keyData.expiry_timestamp);
                    
                    html += `
                        <div class="api-key-card">
                            <div class="info">
                                <div class="name">ğŸ‘¤ ${keyData.admin_name}</div>
                                <div class="api-key-value">ğŸ”‘ ${keyData.api_key.substring(0, 20)}...</div>
                                <div class="details">
                                    <span style="color: ${statusColor}; font-weight: 600;">${status}</span> | 
                                    ğŸ”’ ${permissionText} | 
                                    ğŸ“Š ${keyData.usage_count || 0} | 
                                    â±ï¸ <span class="time-remaining ${timeClass}">${timeRemaining}</span>
                                </div>
                            </div>
                            <div class="actions api-actions">
                                <button class="btn-small" onclick="copyToClipboard('${keyData.api_key}', 'âœ… Ù†Ø³Ø®!')">ğŸ“‹ Ù†Ø³Ø®</button>
                                <button class="btn-small" onclick="toggleKeyStatus('${keyId}', ${keyData.is_active})">
                                    ${keyData.is_active ? 'â¸ï¸ ØªØ¹Ø·ÙŠÙ„' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                                </button>
                                <button class="btn-small btn-danger" onclick="deleteApiKey('${keyId}', '${keyData.admin_name}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                }
                
                apiKeysList.innerHTML = html;
            } catch (error) {
                apiKeysList.innerHTML = '<p style="text-align: center; color: #f44336; padding: 40px;">âŒ ÙØ´Ù„</p>';
            }
        }
        window.loadApiKeys = loadApiKeys;
        
        async function toggleKeyStatus(keyId, currentStatus) {
            try {
                const response = await fetch(`${DB_URL}/api_keys/${keyId}/is_active.json`, {
                    method: 'PUT',
                    body: JSON.stringify(!currentStatus)
                });
                if (response.ok) {
                    showAlert(`âœ… ØªÙ… ${!currentStatus ? 'Ø§Ù„ØªÙØ¹ÙŠÙ„' : 'Ø§Ù„ØªØ¹Ø·ÙŠÙ„'}!`, 'success');
                    loadApiKeys();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.toggleKeyStatus = toggleKeyStatus;
        
        async function deleteApiKey(keyId, adminName) {
            if (!confirm(`Ø­Ø°Ù API Key Ù„Ù€ "${adminName}"ØŸ`)) return;
            try {
                const response = await fetch(`${DB_URL}/api_keys/${keyId}.json`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert(`âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù!`, 'success');
                    loadApiKeys();
                }
            } catch (error) {
                showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        window.deleteApiKey = deleteApiKey;

        // ========================================
        // Statistics
        // ========================================
        async function loadStats() {
            try {
                const [usersRes, keysRes] = await Promise.all([
                    fetch(`${DB_URL}/users.json`),
                    fetch(`${DB_URL}/api_keys.json`)
                ]);
                
                const users = await usersRes.json() || {};
                const keys = await keysRes.json() || {};
                
                const now = Date.now();
                const totalUsers = Object.keys(users).length;
                const activeUsers = Object.values(users).filter(u => u.is_active && u.expiry_timestamp > now).length;
                const expiredUsers = Object.values(users).filter(u => u.expiry_timestamp <= now).length;
                const totalKeys = Object.keys(keys).length;
                
                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('expiredUsers').textContent = expiredUsers;
                document.getElementById('totalKeys').textContent = totalKeys;
                
                const durationStats = document.getElementById('durationStats');
                const durations = Object.values(users).map(u => {
                    if (!u.expiry_timestamp) return 0;
                    const remaining = u.expiry_timestamp - now;
                    return Math.max(0, Math.floor(remaining / (1000 * 60)));
                }).filter(d => d > 0);
                
                if (durations.length > 0) {
                    const avg = Math.floor(durations.reduce((a, b) => a + b, 0) / durations.length);
                    const min = Math.min(...durations);
                    const max = Math.max(...durations);
                    
                    durationStats.innerHTML = `
                        <p style="padding: 10px; margin-bottom: 8px;">â±ï¸ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯Ø©: ${formatDuration(avg)}</p>
                        <p style="padding: 10px; margin-bottom: 8px;">â¬‡ï¸ Ø£Ù‚Ù„ Ù…Ø¯Ø©: ${formatDuration(min)}</p>
                        <p style="padding: 10px;">â¬†ï¸ Ø£Ø¹Ù„Ù‰ Ù…Ø¯Ø©: ${formatDuration(max)}</p>
                    `;
                } else {
                    durationStats.innerHTML = '<p style="padding: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                }
                
            } catch (error) {
                console.error('Error:', error);
            }
        }
        window.loadStats = loadStats;

        // ========================================
        // Settings
        // ========================================
        function saveSettings() {
            const autoCleanup = document.getElementById('autoCleanup').checked;
            const enableLogging = document.getElementById('enableLogging').checked;
            const backupEnabled = document.getElementById('backupEnabled').checked;
            const sessionCheckInterval = document.getElementById('sessionCheckInterval').value;
            
            const settings = {
                auto_cleanup: autoCleanup,
                enable_logging: enableLogging,
                backup_enabled: backupEnabled,
                session_check_interval: parseInt(sessionCheckInterval),
                last_updated: Date.now()
            };
            
            localStorage.setItem('admin_settings', JSON.stringify(settings));
            showAlert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª!', 'success');
        }
        window.saveSettings = saveSettings;
        
        function loadSettings() {
            const saved = localStorage.getItem('admin_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('autoCleanup').checked = settings.auto_cleanup || false;
                document.getElementById('enableLogging').checked = settings.enable_logging || true;
                document.getElementById('backupEnabled').checked = settings.backup_enabled || false;
                document.getElementById('sessionCheckInterval').value = settings.session_check_interval || 5;
            }
        }

        function copyDBUrl() {
            const dbUrl = document.getElementById('dbUrl').value;
            copyToClipboard(dbUrl, 'âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
        }
        window.copyDBUrl = copyDBUrl;

        // ========================================
        // Utilities
        // ========================================
        function copyToClipboard(text, successMsg = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!') {
            if (typeof Android !== 'undefined' && Android.copyToClipboard) {
                Android.copyToClipboard(text);
                if (Android.showToast) {
                    Android.showToast(successMsg);
                } else {
                    showAlert(successMsg, 'success');
                }
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            textarea.style.left = '-999999px';
            textarea.style.top = '-999999px';
            document.body.appendChild(textarea);
            
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        showAlert(successMsg, 'success');
                    }).catch(() => {
                        textarea.select();
                        textarea.setSelectionRange(0, 99999);
                        document.execCommand('copy');
                        showAlert(successMsg, 'success');
                    });
                } else {
                    textarea.select();
                    textarea.setSelectionRange(0, 99999);
                    document.execCommand('copy');
                    showAlert(successMsg, 'success');
                }
            } catch (err) {
                console.error('Failed to copy:', err);
                showAlert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', 'error');
            } finally {
                document.body.removeChild(textarea);
            }
        }
        window.copyToClipboard = copyToClipboard;

        // ========================================
        // Session Monitoring
        // ========================================
        setInterval(() => {
            checkExpiredSessions();
        }, 5 * 60 * 1000);
        
        async function checkExpiredSessions() {
            const settings = JSON.parse(localStorage.getItem('admin_settings') || '{}');
            if (!settings.auto_cleanup) return;
            
            try {
                const response = await fetch(`${DB_URL}/users.json`);
                const users = await response.json();
                const now = Date.now();
                
                if (users) {
                    for (const [userId, userData] of Object.entries(users)) {
                        if (userData.expiry_timestamp && userData.expiry_timestamp <= now) {
                            await fetch(`${DB_URL}/users/${userId}.json`, {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    force_logout: true,
                                    logout_timestamp: now,
                                    session_token: null
                                })
                            });
                        }
                    }
                }
            } catch (error) {
                console.error('Session check error:', error);
            }
        }

        // ========================================
        // Keyboard Shortcuts & Auto-Refresh
        // ========================================
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                loadUsers();
                showAlert('ğŸ”„ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'success');
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportUsers('json');
            }
            
            if (e.key === 'Escape') {
                closeExtendModal();
                closeForceModal();
            }
        });
        
        setInterval(() => {
            const activeTab = document.querySelector('.tab.active');
            if (activeTab && activeTab.textContent.includes('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†')) {
                loadUsers();
            }
        }, 2 * 60 * 1000);
    </script>
</body>
</html>
